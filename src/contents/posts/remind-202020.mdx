---
title: "macOSでn分ごとに通知する"
desc: "macOSで、スリープが解除されてからn分ごとに通知を表示する方法"
pubDate: 2025-10-28
tags: ["macOS", "AppleScript", "通知"]
pub: true
---

import Details from "@layouts/Details.astro";
import X from "@components/XEmbed.astro";
// 必ずclientディレクティブを設定する
import Quiz from "@components/Quiz";

## はじめに

macOSで、スリープが解除されてからn分ごとに通知を表示する方法をまとめておきます。

## システム構成

今回のシステム構成は以下の通りです。

1. [SleepWatcher](https://www.bernhard-baehr.de)を使ってスリープ解除を検知し、Pythonスクリプトを実行する
1. Pythonスクリプトにて、n分ごとにAppleScriptを実行し、通知を表示する

## 手順

### Python スクリプトを書く

`while`ループと`sleep`を使って、一定間隔でAppleScript(`osascript`)を実行します。
以下は20分ごとに通知を表示する例で、`sleep_minutes = 20` の部分を変更すれば、任意の分数に変更できます。

```python
import time
import subprocess
import signal
import sys
from types import FrameType
from typing import Optional

def notify(title: str, message: str):
    subprocess.run(
        [
            "osascript",
            "-e",
            f'display notification "{message}" with title "{title}" sound name "Ping"',
        ]
    )


def handle_sigterm(_signum: int, _frame: Optional[FrameType]):
    # 必要ならここでログや後始末
    sys.exit(0)


def main():
    # notify("20-20-20ルールスタート", "スタートです。")
    signal.signal(signal.SIGTERM, handle_sigterm)

    sleep_minutes = 20
    MINUTE_SEC = 60
    while True:
        time.sleep(sleep_minutes * MINUTE_SEC)
        notify("20-20-20ルール", "20秒間、6m先を見ましょう！")


if __name__ == "__main__":
    main()
```

### SleepWatcherの設定

SleepWatcherの設定ファイルを作成します。

まず、スリープ解除時の処理として、Pythonスクリプトを起動するコマンドを書きます。
`~/.wakeup`にPythonスクリプトを起動するコマンドを記述します。

念のため、既に起動している同じスクリプトを終了させてから、新たに起動するようにしています。

```zsh:~/.wakeup
#!/bin/zsh

CMD=(/opt/homebrew/bin/uv run /Users/riku/Private/Languages/Python/notify202020/main.py)
pkill -f $CMD 2>/dev/null
nohup $CMD >/tmp/20rule.log 2>&1 &

```

この例では`uv`を使ってPythonスクリプトを実行しているが、`python3`や`python`コマンドを使っても問題ありません。
その場合は`CMD`が以下のようになります。

```
python3 /path/to/your/script.py
```

次に、スリープ時にPythonスクリプトを終了させるコマンドを書きます。
`~/.sleep`にファイルを作成します。

```zsh:~/.sleep
#!/bin/zsh

CMD=(/opt/homebrew/bin/uv run /Users/riku/Private/Languages/Python/notify202020/main.py)
pkill -f $CMD 2> /dev/null
```

### SleepWatcherのインストール

Homebrewでインストールできます。

```zsh
brew install sleepwatcher
```

### SleepWatcherの起動設定

Homebrewのサービスとして起動します。
```zsh
brew services start sleepwatcher
```

## おわりに

この方法を使って、定期的に休憩を促す通知を表示できます。休憩の目安として使ってみるといいかもしれません。


## 参考

https://zenn.dev/c6tower/articles/5fcb5299f410d4

https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/DisplayNotifications.html


